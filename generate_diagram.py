"""
Gerador de Diagrama de Rede
Cria uma visualizaÃ§Ã£o grÃ¡fica da topologia hierÃ¡rquica
"""

try:
    import matplotlib.pyplot as plt
    import matplotlib.patches as mpatches
    from matplotlib.patches import FancyBboxPatch, FancyArrowPatch
    MATPLOTLIB_AVAILABLE = True
except ImportError:
    MATPLOTLIB_AVAILABLE = False
    print("âš ï¸  matplotlib nÃ£o estÃ¡ instalado. Gerando diagrama em texto...")


def generate_text_diagram():
    """Gera um diagrama em texto ASCII"""
    diagram = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    TOPOLOGIA DE REDE HIERÃRQUICA                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   c1 (Core)  â”‚
                            â”‚ 192.168.21.1 â”‚
                            â”‚ 192.168.22.1 â”‚
                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Fibra Ã“ptica 10Gbps                        Fibra Ã“ptica 10Gbps  â”‚
    â”‚                                                                  â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”
â”‚  a1 (Aggreg)   â”‚                                        â”‚  a2 (Aggreg)   â”‚
â”‚ 192.168.21.2   â”‚                                        â”‚ 192.168.22.2   â”‚
â”‚ 192.168.11.1   â”‚                                        â”‚ 192.168.13.1   â”‚
â”‚ 192.168.12.1   â”‚                                        â”‚ 192.168.14.1   â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                                        â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”‚        â”‚                                                â”‚        â”‚
    â”‚ Cat6   â”‚ Cat6                                    Cat6   â”‚        â”‚ Cat6
    â”‚ 1Gbps  â”‚ 1Gbps                                   1Gbps  â”‚        â”‚ 1Gbps
    â”‚        â”‚                                                â”‚        â”‚
â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â” â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚   e1   â”‚ â”‚    e2    â”‚                            â”‚    e3     â”‚  â”‚    e4    â”‚
â”‚ (Edge) â”‚ â”‚  (Edge)  â”‚                            â”‚  (Edge)   â”‚  â”‚  (Edge)  â”‚
â”‚.1.1/28 â”‚ â”‚.2.1/28   â”‚                            â”‚.3.1/27    â”‚  â”‚.4.1/27   â”‚
â””â”¬â”€â”€â”€â”€â”€â”€â”¬â”˜ â””â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜                            â””â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜  â””â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”˜
 â”‚      â”‚   â”‚        â”‚                              â”‚         â”‚    â”‚        â”‚
 â”‚Cat5e â”‚   â”‚ Cat5e  â”‚                              â”‚ Cat5e   â”‚    â”‚ Cat5e  â”‚
 â”‚100M  â”‚   â”‚ 100M   â”‚                              â”‚ 100M    â”‚    â”‚ 100M   â”‚
 â”‚      â”‚   â”‚        â”‚                              â”‚         â”‚    â”‚        â”‚
â”Œâ”´â”€â”  â”Œâ”€â”´â” â”Œâ”´â”€â”    â”Œâ”€â”´â”                           â”Œâ”´â”€â”     â”Œâ”€â”´â”  â”Œâ”´â”€â”    â”Œâ”€â”´â”
â”‚h1â”‚  â”‚h2â”‚ â”‚h3â”‚    â”‚h4â”‚                           â”‚h5â”‚     â”‚h6â”‚  â”‚h7â”‚    â”‚h8â”‚
â”œâ”€â”€â”¤  â”œâ”€â”€â”¤ â”œâ”€â”€â”¤    â”œâ”€â”€â”¤                           â”œâ”€â”€â”¤     â”œâ”€â”€â”¤  â”œâ”€â”€â”¤    â”œâ”€â”€â”¤
â”‚.2â”‚  â”‚.3â”‚ â”‚.2â”‚    â”‚.3â”‚                           â”‚.2â”‚     â”‚.3â”‚  â”‚.2â”‚    â”‚.3â”‚
â””â”€â”€â”˜  â””â”€â”€â”˜ â””â”€â”€â”˜    â””â”€â”€â”˜                           â””â”€â”€â”˜     â””â”€â”€â”˜  â””â”€â”€â”˜    â””â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LEGENDA DE ENDEREÃ‡OS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAMADA CORE                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ c1: 192.168.21.1/30 (â†’a1), 192.168.22.1/30 (â†’a2)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAMADA AGGREGATION                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ a1: 192.168.11.1/30 (â†’e1), 192.168.12.1/30 (â†’e2), 192.168.21.2/30 (â†’c1)  â”‚
â”‚ a2: 192.168.13.1/30 (â†’e3), 192.168.14.1/30 (â†’e4), 192.168.22.2/30 (â†’c1)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAMADA EDGE                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ e1: 192.168.1.1/28 (hosts), 192.168.11.2/30 (â†’a1)                         â”‚
â”‚ e2: 192.168.2.1/28 (hosts), 192.168.12.2/30 (â†’a1)                         â”‚
â”‚ e3: 192.168.3.1/27 (hosts), 192.168.13.2/30 (â†’a2)                         â”‚
â”‚ e4: 192.168.4.1/27 (hosts), 192.168.14.2/30 (â†’a2)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CAMADA HOST                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ h1: 192.168.1.2/28  â”‚  h2: 192.168.1.3/28   (Gateway: 192.168.1.1)         â”‚
â”‚ h3: 192.168.2.2/28  â”‚  h4: 192.168.2.3/28   (Gateway: 192.168.2.1)         â”‚
â”‚ h5: 192.168.3.2/27  â”‚  h6: 192.168.3.3/27   (Gateway: 192.168.3.1)         â”‚
â”‚ h7: 192.168.4.2/27  â”‚  h8: 192.168.4.3/27   (Gateway: 192.168.4.1)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TIPOS DE ENLACES:

  Core â†” Aggregation:  Fibra Ã“ptica - 10 Gbps
  Aggregation â†” Edge:  Par TranÃ§ado Cat6 - 1 Gbps  
  Edge â†” Host:         Par TranÃ§ado Cat5e - 100 Mbps

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
    return diagram


def generate_graphical_diagram():
    """Gera um diagrama grÃ¡fico usando matplotlib"""
    if not MATPLOTLIB_AVAILABLE:
        return None
    
    fig, ax = plt.subplots(1, 1, figsize=(16, 12))
    ax.set_xlim(0, 16)
    ax.set_ylim(0, 12)
    ax.axis('off')
    
    # Cores para diferentes camadas
    color_core = '#FF6B6B'
    color_agg = '#4ECDC4'
    color_edge = '#45B7D1'
    color_host = '#96CEB4'
    
    # FunÃ§Ã£o para desenhar dispositivo
    def draw_device(x, y, label, ip_list, color, device_type='router'):
        if device_type == 'host':
            # RetÃ¢ngulo para host
            box = FancyBboxPatch((x-0.4, y-0.3), 0.8, 0.6,
                                boxstyle="round,pad=0.05", 
                                facecolor=color, edgecolor='black', linewidth=2)
        else:
            # CÃ­rculo para roteador
            circle = plt.Circle((x, y), 0.4, color=color, ec='black', linewidth=2)
            ax.add_patch(circle)
            box = None
        
        if box:
            ax.add_patch(box)
        
        # Label do dispositivo
        ax.text(x, y + 0.1, label, ha='center', va='center', 
                fontsize=12, fontweight='bold')
        
        # IPs
        y_offset = -0.15
        for ip in ip_list:
            ax.text(x, y + y_offset, ip, ha='center', va='center', 
                    fontsize=8, style='italic')
            y_offset -= 0.15
    
    # FunÃ§Ã£o para desenhar link
    def draw_link(x1, y1, x2, y2, label='', style='-'):
        arrow = FancyArrowPatch((x1, y1), (x2, y2),
                               arrowstyle='-', 
                               linestyle=style,
                               linewidth=2, 
                               color='gray',
                               mutation_scale=20)
        ax.add_patch(arrow)
        
        if label:
            mid_x, mid_y = (x1 + x2) / 2, (y1 + y2) / 2
            ax.text(mid_x, mid_y, label, ha='center', va='bottom',
                   fontsize=7, bbox=dict(boxstyle='round', facecolor='white', alpha=0.8))
    
    # TÃTULO
    ax.text(8, 11.5, 'TOPOLOGIA DE REDE HIERÃRQUICA', 
            ha='center', va='center', fontsize=18, fontweight='bold')
    
    # CAMADA CORE (y=9.5)
    ax.text(1, 10, 'CORE', fontsize=10, fontweight='bold', color=color_core)
    draw_device(8, 9.5, 'c1', ['192.168.21.1', '192.168.22.1'], color_core)
    
    # CAMADA AGGREGATION (y=7)
    ax.text(1, 7.5, 'AGGREGATION', fontsize=10, fontweight='bold', color=color_agg)
    draw_device(5, 7, 'a1', ['192.168.21.2', '192.168.11.1', '192.168.12.1'], color_agg)
    draw_device(11, 7, 'a2', ['192.168.22.2', '192.168.13.1', '192.168.14.1'], color_agg)
    
    # Links Core-Aggregation
    draw_link(8, 9.1, 5.3, 7.3, 'Fibra 10Gbps')
    draw_link(8, 9.1, 10.7, 7.3, 'Fibra 10Gbps')
    
    # CAMADA EDGE (y=4.5)
    ax.text(1, 5, 'EDGE', fontsize=10, fontweight='bold', color=color_edge)
    draw_device(3, 4.5, 'e1', ['192.168.1.1'], color_edge)
    draw_device(6.5, 4.5, 'e2', ['192.168.2.1'], color_edge)
    draw_device(9.5, 4.5, 'e3', ['192.168.3.1'], color_edge)
    draw_device(13, 4.5, 'e4', ['192.168.4.1'], color_edge)
    
    # Links Aggregation-Edge
    draw_link(4.7, 6.7, 3.3, 4.8, 'Cat6 1Gbps', '--')
    draw_link(5.3, 6.7, 6.2, 4.8, 'Cat6 1Gbps', '--')
    draw_link(10.7, 6.7, 9.8, 4.8, 'Cat6 1Gbps', '--')
    draw_link(11.3, 6.7, 12.7, 4.8, 'Cat6 1Gbps', '--')
    
    # CAMADA HOST (y=2)
    ax.text(1, 2.5, 'HOST', fontsize=10, fontweight='bold', color=color_host)
    # Hosts sob e1
    draw_device(2, 2, 'h1', ['192.168.1.2'], color_host, 'host')
    draw_device(4, 2, 'h2', ['192.168.1.3'], color_host, 'host')
    # Hosts sob e2
    draw_device(5.5, 2, 'h3', ['192.168.2.2'], color_host, 'host')
    draw_device(7.5, 2, 'h4', ['192.168.2.3'], color_host, 'host')
    # Hosts sob e3
    draw_device(8.5, 2, 'h5', ['192.168.3.2'], color_host, 'host')
    draw_device(10.5, 2, 'h6', ['192.168.3.3'], color_host, 'host')
    # Hosts sob e4
    draw_device(12, 2, 'h7', ['192.168.4.2'], color_host, 'host')
    draw_device(14, 2, 'h8', ['192.168.4.3'], color_host, 'host')
    
    # Links Edge-Host
    draw_link(2.7, 4.2, 2.3, 2.3, 'Cat5e 100M', ':')
    draw_link(3.3, 4.2, 3.7, 2.3, 'Cat5e 100M', ':')
    draw_link(6.2, 4.2, 5.8, 2.3, 'Cat5e 100M', ':')
    draw_link(6.8, 4.2, 7.2, 2.3, 'Cat5e 100M', ':')
    draw_link(9.2, 4.2, 8.8, 2.3, 'Cat5e 100M', ':')
    draw_link(9.8, 4.2, 10.2, 2.3, 'Cat5e 100M', ':')
    draw_link(12.7, 4.2, 12.3, 2.3, 'Cat5e 100M', ':')
    draw_link(13.3, 4.2, 13.7, 2.3, 'Cat5e 100M', ':')
    
    # Legenda
    legend_y = 0.5
    ax.text(8, legend_y, 
            'Fibra Ã“ptica (â€”) | Par TranÃ§ado Cat6 (--) | Par TranÃ§ado Cat5e (â‹¯)',
            ha='center', fontsize=9, 
            bbox=dict(boxstyle='round', facecolor='lightyellow'))
    
    plt.tight_layout()
    return fig


def main():
    """FunÃ§Ã£o principal"""
    print("\n" + "="*80)
    print(" GERADOR DE DIAGRAMA DE REDE")
    print("="*80)
    
    # Gera diagrama em texto
    print("\nğŸ“Š Diagrama em Texto:")
    text_diagram = generate_text_diagram()
    print(text_diagram)
    
    # Salva diagrama em texto
    with open('diagrama_rede.txt', 'w', encoding='utf-8') as f:
        f.write(text_diagram)
    print("\nâœ“ Diagrama em texto salvo em: diagrama_rede.txt")
    
    # Tenta gerar diagrama grÃ¡fico
    if MATPLOTLIB_AVAILABLE:
        print("\nğŸ“Š Gerando diagrama grÃ¡fico...")
        fig = generate_graphical_diagram()
        if fig:
            fig.savefig('diagrama_rede.png', dpi=300, bbox_inches='tight')
            print("âœ“ Diagrama grÃ¡fico salvo em: diagrama_rede.png")
            
            # Pergunta se quer exibir
            try:
                plt.show()
            except:
                pass
    else:
        print("\nâš ï¸  Para gerar diagrama grÃ¡fico, instale matplotlib:")
        print("    pip install matplotlib")
    
    print("\n" + "="*80)


if __name__ == "__main__":
    main()
